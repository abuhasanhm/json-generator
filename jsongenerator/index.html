<!doctype html><html lang="id"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Masjid JSON Generator</title><style>:root{--bg:#0b1220;--panel:#0f1a2e;--muted:#98a5c0;--text:#e9f1ff;--brand:#10b981;--accent:#06b46b;--line:#ffffff12}*{box-sizing:border-box}html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Roboto,Arial}main{max-width:1100px;margin:28px auto;padding:20px}h1{font-size:36px;text-align:center;color:var(--brand);margin:6px 0 18px}card,section{display:block}section.card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border:1px solid var(--line);border-radius:12px;padding:18px;margin-bottom:16px}label{display:block;color:var(--muted);font-weight:700;margin-bottom:6px}input[type=text],input[type=number],textarea,select{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.04);background:#071021;color:var(--text);outline:none;font-size:15px}textarea{min-height:84px}small.hint{color:#9fb0c8;display:block;margin-top:8px}#slides_list .slide-item{border-radius:10px;padding:12px;background:rgba(255,255,255,.01);margin-bottom:10px}button.btn{background:#0f1a2d;border:1px solid #ffffff16;padding:10px 14px;border-radius:10px;color:var(--text);font-weight:800;cursor:pointer}button.green{background:linear-gradient(90deg,var(--brand),#059669);color:#001;border:0}.row{display:flex;gap:12px}col{display:block}@media(max-width:720px){.row{flex-direction:column}.row .half{width:100%}.keu-grid{display:block}.keu-grid .keu-row{display:flex;flex-direction:column;gap:8px}.side-panel{position:fixed;right:12px;top:80px}}@media(min-width:721px){.half{flex:1}}.muted{color:var(--muted)}.side-panel{position:fixed;right:18px;top:140px;display:flex;flex-direction:column;gap:10px;z-index:999}.tiny{padding:8px 12px;border-radius:10px;background:#071426;border:1px solid #ffffff12;color:var(--text);font-weight:700}.status{margin-top:8px;color:#cfeccf;font-weight:700}.pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.03);border:1px solid #ffffff10;color:var(--muted);font-weight:700}select.small{padding:8px}fieldset.inline{display:flex;gap:8px;flex-wrap:wrap;border:none;padding:0;margin:8px 0}label.small{font-weight:600;color:var(--muted);margin-right:8px}a.link{color:var(--brand);text-decoration:underline}#pushBarMobile{display:none}@media(max-width:720px){.side-panel{display:none}#pushBarMobile{display:flex;position:fixed;left:8px;right:8px;bottom:12px;gap:8px;z-index:999;justify-content:space-between}}.day-checkbox{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:8px;background:#071426;border:1px solid #ffffff08;color:var(--muted)}.keu-grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr;gap:10px;align-items:center}@media(max-width:900px){.keu-grid{grid-template-columns:1fr}.keu-row{display:flex;flex-direction:column;gap:8px}}.small-muted{font-size:.9rem;color:#98a5c0}</style></head><body><main><h1>â–¶ Masjid JSON Generator</h1>

<section class="card" id="s_meta"><div style="display:flex;align-items:center;gap:10px;margin-bottom:12px"><div class="pill">1</div><h2 style="margin:0;color:var(--brand)">Identitas Masjid</h2></div><div class="row"><div class="half"><label>Nama Masjid<input id="meta_name" type="text" placeholder="Masjid At Taubah"></label></div><div class="half"><label>Alamat<input id="meta_addr" type="text" placeholder="Perum T Murni RW-15"></label></div></div><div class="row" style="margin-top:8px"><div class="half"><label>Latitude (boleh kosong)<input id="meta_lat" type="text" placeholder="Latitude (boleh kosong)"></label></div><div class="half"><label>Longitude (boleh kosong)<input id="meta_lon" type="text" placeholder="Longitude (boleh kosong)"></label></div></div><div style="margin-top:8px"><label>ID Kota MyQuran<input id="meta_myq" type="number" placeholder="1203"></label><small class="hint">ðŸ”Ž Belum tahu kode kota? lihat <a class="link" href="https://api.myquran.com/v2/sholat/kota/semua" target="_blank">daftar kota MyQuran</a></small></div></section>

<section class="card" id="s_slides"><div style="display:flex;align-items:center;gap:10px;margin-bottom:12px"><div class="pill">2</div><h2 style="margin:0;color:var(--brand)">Slide Gambar</h2></div><div id="slides_list"></div><div style="margin-top:8px"><button id="addSlide" class="btn">+ Tambah Slide</button><small class="hint">Kamu bisa atur jadwal tampil tiap slide (Always, Weekly, Date, Range). Untuk Weekly pilih hari di opsi.</small></div></section>

<section class="card" id="s_rt"><div style="display:flex;align-items:center;gap:10px;margin-bottom:12px"><div class="pill">3</div><h2 style="margin:0;color:var(--brand)">Running Text</h2></div><label>Isi baris per baris<textarea id="rt_content" placeholder="Selamat datang di Masjid At Taubah&#10;Jadwal sholat mengikuti kota setempat"></textarea></label></section>

<section class="card" id="s_offsets"><div style="display:flex;align-items:center;gap:10px;margin-bottom:12px"><div class="pill">4</div><h2 style="margin:0;color:var(--brand)">Koreksi Jadwal (Offsets)</h2></div><div class="keu-grid" style="grid-template-columns:repeat(6,1fr)"><label>Fajr<input id="off_Fajr" type="number" placeholder="0"></label><label>Sunrise<input id="off_Sunrise" type="number" placeholder="0"></label><label>Dhuhr<input id="off_Dhuhr" type="number" placeholder="0"></label><label>Asr<input id="off_Asr" type="number" placeholder="0"></label><label>Maghrib<input id="off_Maghrib" type="number" placeholder="0"></label><label>Isha<input id="off_Isha" type="number" placeholder="0"></label></div></section>

<section class="card" id="s_iqamah"><div style="display:flex;align-items:center;gap:10px;margin-bottom:12px"><div class="pill">5</div><h2 style="margin:0;color:var(--brand)">Iqamah (menit)</h2></div><div class="keu-grid" style="grid-template-columns:repeat(5,1fr)"><label>Fajr<input id="iq_Fajr" type="number" placeholder="10"></label><label>Dhuhr<input id="iq_Dhuhr" type="number" placeholder="10"></label><label>Asr<input id="iq_Asr" type="number" placeholder="10"></label><label>Maghrib<input id="iq_Maghrib" type="number" placeholder="5"></label><label>Isha<input id="iq_Isha" type="number" placeholder="10"></label></div></section>

<section class="card" id="s_notify"><div style="display:flex;align-items:center;gap:10px;margin-bottom:12px"><div class="pill">6</div><h2 style="margin:0;color:var(--brand)">Notifikasi & Adzan</h2></div><div class="row"><div class="half"><label>Notify seconds<input id="notify_seconds" type="number" placeholder="240"></label></div><div class="half"><label>Started minutes<input id="notify_startedMinutes" type="number" placeholder="10"></label></div></div><div style="margin-top:8px" class="row"><div class="half"><label>Adzan beep seconds<input id="adzan_beepSeconds" type="number" placeholder="5"></label></div><div class="half"><label>Adzan pattern<select id="adzan_pattern" class="small"><option value="standard">standard</option><option value="short">short</option><option value="melody">melody</option></select></label></div></div></section>

<section class="card" id="s_keu"><div style="display:flex;align-items:center;gap:10px;margin-bottom:12px"><div class="pill">7</div><h2 style="margin:0;color:var(--brand)">Data Keuangan</h2></div><div id="keu_list"></div><div style="margin-top:8px"><button id="addKeu" class="btn">+ Tambah Data Keuangan</button><label style="display:block;margin-top:8px">Hadist (opsional)<textarea id="keu_hadist" placeholder="Dan apa saja yang kamu infakkan..."></textarea></label></div></section>

<section class="card" id="s_auth"><div style="display:flex;align-items:center;gap:10px;margin-bottom:12px"><div class="pill">8</div><h2 style="margin:0;color:var(--brand)">Auth / Token (opsional)</h2></div><label>Token (untuk file auth di JSON)<input id="auth_token" type="text" placeholder="MATTAUBAH"></label></section>

<div class="side-panel" role="toolbar" aria-label="Push toolbar">
  <button id="btnSecret" class="tiny">Set PUSH Secret</button>
  <button id="btnGenerate" class="tiny">Tampilkan JSON</button>
  <button id="btnPush" class="tiny green">Push ke GitHub</button>
  <button id="btnWA" class="tiny" style="background:linear-gradient(90deg,#10b981,#059669);color:#001">Kirim ke WA Admin</button>
  <button id="btnReset" class="tiny">Reset Form</button>
  <div id="pushStatus" class="status"></div>
</div>

<div id="pushBarMobile"><button id="m_gen" class="btn">JSON</button><button id="m_push" class="btn green">Push</button></div>

</main>

<script>
const LS_PREFIX='masjid_jg_';
const saveLast=(k,v)=>localStorage.setItem(LS_PREFIX+k,JSON.stringify(v));
const loadLast=k=>{try{return JSON.parse(localStorage.getItem(LS_PREFIX+k));}catch{return null;}};
const $=(s,root=document)=>root.querySelector(s);const $all=(s,root=document)=>Array.from((root||document).querySelectorAll(s));
function setPlaceholdersFromLast(){const keys=['meta_name','meta_addr','meta_lat','meta_lon','meta_myq','notify_seconds','notify_startedMinutes','adzan_beepSeconds','adzan_pattern','keu_hadist','auth_token'];keys.forEach(k=>{const v=loadLast(k);if(v!=null){const el=$( '#'+k ); if(el) el.value = v;}})}
setPlaceholdersFromLast();

function makeSlideEl(data){const el=document.createElement('div');el.className='slide-item';el.innerHTML=`
  <label>Image URL<input class="slide-src" type="text" value="${(data?.src||'')}" placeholder="https://..."></label>
  <label>Caption<input class="slide-caption" type="text" value="${(data?.caption||'')}" placeholder="Caption"></label>
  <label>Schedule<select class="slide-schedule"><option value="always">Always</option><option value="weekly">Weekly</option><option value="date">Date</option><option value="range">Range</option></select></label>
  <div class="weekly-area" style="margin-top:8px;display:none">
    <div class="small-muted">Pilih hari:</div>
    <div style="display:flex;gap:8px;margin-top:6px">
      <label class="day-checkbox"><input type="checkbox" class="slide-weekday" value="0">Sun</label>
      <label class="day-checkbox"><input type="checkbox" class="slide-weekday" value="1">Mon</label>
      <label class="day-checkbox"><input type="checkbox" class="slide-weekday" value="2">Tue</label>
      <label class="day-checkbox"><input type="checkbox" class="slide-weekday" value="3">Wed</label>
      <label class="day-checkbox"><input type="checkbox" class="slide-weekday" value="4">Thu</label>
      <label class="day-checkbox"><input type="checkbox" class="slide-weekday" value="5">Fri</label>
      <label class="day-checkbox"><input type="checkbox" class="slide-weekday" value="6">Sat</label>
    </div>
  </div>
  <div style="margin-top:8px;display:flex;gap:8px"><button class="btn slide-up">â–²</button><button class="btn slide-down">â–¼</button><button class="btn slide-del" style="background:#2a1111">Hapus</button></div>
`;const sel=el.querySelector('.slide-schedule');if(data?.schedule?.type)sel.value=data.schedule.type;if(data?.schedule?.days) data.schedule.days.forEach(d=>{const ck=el.querySelector('.slide-weekday[value="'+d+'"]'); if(ck) ck.checked=true});sel.onchange=()=>{if(sel.value==='weekly') el.querySelector('.weekly-area').style.display='block'; else el.querySelector('.weekly-area').style.display='none'};el.querySelector('.slide-del').onclick=()=>{el.remove();saveSlidesToLast()};el.querySelector('.slide-up').onclick=()=>{const p=el.previousElementSibling; if(p){el.parentNode.insertBefore(el,p); saveSlidesToLast()}};el.querySelector('.slide-down').onclick=()=>{const n=el.nextElementSibling; if(n){el.parentNode.insertBefore(n,el); saveSlidesToLast()}};el.querySelectorAll('input,select').forEach(i=>i.addEventListener('input',saveSlidesToLast));return el}
function saveSlidesToLast(){const arr=$all('#slides_list .slide-item').map(si=>({src:si.querySelector('.slide-src').value||'',caption:si.querySelector('.slide-caption').value||'',schedule:(()=>{const t=si.querySelector('.slide-schedule').value;const o={type:t}; if(t==='weekly'){o.days=$all('.slide-weekday:checked',si).map(c=>Number(c.value))} return o})()}));saveLast('slides',arr)}
function loadSlidesFromLast(){const s=loadLast('slides');const box=$('#slides_list');box.innerHTML='';if(Array.isArray(s)&&s.length){s.forEach(sl=>box.appendChild(makeSlideEl(sl)))}else{box.appendChild(makeSlideEl({src:'https://wisatamuliainsani.com/wp-content/uploads/2024/07/Mengintip-Keindahan-Kota-Thaif-yang-Penuh-dengan-Sejarah-Wisata-Mulia-Insani-scaled.jpg',caption:'Thaif',schedule:{type:'always'}}))}}
document.getElementById('addSlide').onclick=()=>{const box=$('#slides_list');box.appendChild(makeSlideEl({}));saveSlidesToLast()};loadSlidesFromLast();

function addKeuRow(d){const box=$('#keu_list');const r=document.createElement('div');r.className='keu-row';r.innerHTML=`<div style="display:flex;gap:8px;flex-wrap:wrap"><input class="keu-year" placeholder="2025" style="width:100px;padding:8px;border-radius:8px;background:#071021;border:1px solid rgba(255,255,255,.04)"><input class="keu-month" placeholder="01" style="width:80px;padding:8px;border-radius:8px;background:#071021;border:1px solid rgba(255,255,255,.04)"><input class="keu-penerimaan" placeholder="penerimaan" style="flex:1;padding:8px;border-radius:8px;background:#071021;border:1px solid rgba(255,255,255,.04)"><input class="keu-pengeluaran" placeholder="pengeluaran" style="flex:1;padding:8px;border-radius:8px;background:#071021;border:1px solid rgba(255,255,255,.04)"><input class="keu-saldo" placeholder="saldo" style="width:140px;padding:8px;border-radius:8px;background:#071021;border:1px solid rgba(255,255,255,.04)"><button class="btn" style="background:#2a1111">Hapus</button></div>`;box.appendChild(r);if(d){r.querySelector('.keu-year').value=d.year; r.querySelector('.keu-month').value=d.month; r.querySelector('.keu-penerimaan').value=d.penerimaan; r.querySelector('.keu-pengeluaran').value=d.pengeluaran; r.querySelector('.keu-saldo').value=d.saldo}r.querySelector('button').onclick=()=>{r.remove();saveKeuLast()};r.querySelectorAll('input').forEach(i=>i.addEventListener('input',saveKeuLast));saveKeuLast()}
function saveKeuLast(){const arr=$all('.keu-row').map(r=>({year:r.querySelector('.keu-year').value||new Date().getFullYear(),month:(r.querySelector('.keu-month').value||'01').padStart(2,'0'),penerimaan:Number(r.querySelector('.keu-penerimaan').value||0),pengeluaran:Number(r.querySelector('.keu-pengeluaran').value||0),saldo:(r.querySelector('.keu-saldo').value!==''?Number(r.querySelector('.keu-saldo').value):(Number(r.querySelector('.keu-penerimaan').value||0)-Number(r.querySelector('.keu-pengeluaran').value||0)))}));saveLast('keu',arr)}
document.getElementById('addKeu').onclick=()=>addKeuRow({year:new Date().getFullYear(),month:'01',penerimaan:0,pengeluaran:0,saldo:0});(function(){const k=loadLast('keu');if(Array.isArray(k)&&k.length)k.forEach(addKeuRow);else addKeuRow({year:new Date().getFullYear(),month:'01',penerimaan:1500000,pengeluaran:500000,saldo:1000000});})();

['meta_name','meta_addr','meta_lat','meta_lon','meta_myq','notify_seconds','notify_startedMinutes','adzan_beepSeconds','adzan_pattern','keu_hadist','auth_token'].forEach(id=>{const el=$('#'+id); if(el) el.addEventListener('input',()=>saveLast(id,el.value))});

function buildJSON(){const metaName=($('#meta_name')||{value:'Masjid At Taubah'}).value;const metaAddr=($('#meta_addr')||{value:'Perum T Murni RW-15'}).value;const lat=($('#meta_lat')||{value:''}).value;const lon=($('#meta_lon')||{value:''}).value;const myq=Number(($('#meta_myq')||{value:'1203'}).value)||1203;const meta={name:metaName,addr:metaAddr,lat:lat?Number(lat):null,lon:lon?Number(lon):null,myqCityId:myq};const slides=$all('#slides_list .slide-item').map(si=>{const src=(si.querySelector('.slide-src')||{value:''}).value;const caption=(si.querySelector('.slide-caption')||{value:''}).value;const t=(si.querySelector('.slide-schedule')||{value:'always'}).value;const s={type:t};if(t==='weekly'){s.days=$all('.slide-weekday:checked',si).map(c=>Number(c.value))}return{src,caption,schedule:s}});const rtText=($('#rt_content')||{value:''}).value.trim();const rt={content:rtText?rtText.split(/\r?\n/).map(s=>s.trim()).filter(Boolean):['Selamat datang di Masjid At Taubah']};const offs={};['Fajr','Sunrise','Dhuhr','Asr','Maghrib','Isha'].forEach(k=>{const v=Number(($('#off_'+k) || {value:0}).value);offs[k]=isNaN(v)?0:v});const iq={};['Fajr','Dhuhr','Asr','Maghrib','Isha'].forEach(k=>{const v=Number(($('#iq_'+k) || {value:10}).value);iq[k]=isNaN(v)?10:v});const notify={notifySeconds:Number($('#notify_seconds')?.value||240),startedMinutes:Number($('#notify_startedMinutes')?.value||10)};const adzan={adzanBeepSeconds:Number($('#adzan_beepSeconds')?.value||5),adzanPattern:($('#adzan_pattern')?.value||'standard')};const keuangan=$all('.keu-row').map(r=>({year:Number(r.querySelector('.keu-year')?.value||new Date().getFullYear()),month:String(r.querySelector('.keu-month')?.value||'01').padStart(2,'0'),penerimaan:Number(r.querySelector('.keu-penerimaan')?.value||0),pengeluaran:Number(r.querySelector('.keu-pengeluaran')?.value||0),saldo:(r.querySelector('.keu-saldo')?.value!==''?Number(r.querySelector('.keu-saldo')?.value):(Number(r.querySelector('.keu-penerimaan')?.value||0)-Number(r.querySelector('.keu-pengeluaran')?.value||0))) }));const keu_meta={hadist:($('#keu_hadist')?.value)||'Dan apa saja yang kamu infakkan, Allah akan menggantinya...'};const auth={token:($('#auth_token')?.value)||'MATTAUBAH',ts:Date.now()};return{meta,slides,rt,offsets:offs,iqamah:iq,notify,adzan,keuangan,keuangan_meta:keu_meta,auth}}

function openBlobHtml(title,htmlContent){try{const blob=new Blob([htmlContent],{type:'text/html'});const url=URL.createObjectURL(blob);const w=window.open(url,'_blank');if(!w){URL.revokeObjectURL(url);return false}setTimeout(()=>URL.revokeObjectURL(url),2500);return true}catch(e){console.error(e);return false}}

$('#btnGenerate').onclick=()=>{try{const j=buildJSON();const s=JSON.stringify(j,null,2);const safe=s.replace(/</g,'\\u003c');const html=`<!doctype html><html><head><meta charset="utf-8"><title>Generated JSON</title><style>body{background:#0b1220;color:#e9f1ff;font-family:Inter,system-ui,Roboto,Arial;padding:18px}pre{white-space:pre-wrap;word-break:break-word;font-size:13px}</style></head><body><pre>${safe}</pre></body></html>`;if(!openBlobHtml('Generated JSON',html)){navigator.clipboard?.writeText(s).then(()=>alert('Popup diblokir â€” JSON disalin ke clipboard'),()=>alert('Popup diblokir â€” salin manual dari console (F12)'))} }catch(e){console.error(e);alert('Gagal menampilkan JSON')}};

const WA_PHONE='6281315161561';
$('#btnWA').onclick=()=>{const j=buildJSON();const s=encodeURIComponent(JSON.stringify(j,null,2));const url=`https://wa.me/${WA_PHONE}?text=${encodeURIComponent('JSON hasil generator:\n')}${s}`;window.open(url,'_blank')};

const LS_PUSH='PUSH_SECRET_JG';
$('#btnSecret').onclick=()=>{const prev=localStorage.getItem(LS_PUSH)||'';const v=prompt('Masukkan PUSH_SECRET (sama dengan PUSH_SECRET di Netlify env):',prev)||'';if(!v) return alert('Tidak disimpan');localStorage.setItem(LS_PUSH,v);alert('PUSH_SECRET tersimpan di browser (localStorage)')};

$('#btnReset').onclick=()=>{if(!confirm('Reset semua input dan data lokal?')) return;document.querySelectorAll('input,textarea,select').forEach(i=>{if(i.type==='checkbox'||i.type==='radio') i.checked=false; else i.value=''});['slides','keu'].forEach(k=>localStorage.removeItem(LS_PREFIX+k));localStorage.removeItem(LS_PUSH);alert('Form direset dan lokal dibersihkan')};

async function doPush(){const secret=localStorage.getItem(LS_PUSH);if(!secret) return alert('PUSH_SECRET belum disimpan. Klik Set PUSH Secret.');const payload=buildJSON();const content=JSON.stringify(payload,null,2);$('#pushStatus').textContent='Mengirim ke GitHub...';try{const res=await fetch('/.netlify/functions/pushJson',{method:'POST',headers:{'Content-Type':'application/json','x-push-secret':secret},body:JSON.stringify({content,path:undefined,message:`Update jammasjid via generator ${new Date().toISOString()}`})});const txt=await res.text();if(!res.ok) throw new Error(txt||res.status);const j=JSON.parse(txt);$('#pushStatus').textContent='âœ… Sukses: '+(j.url||j.commit||'OK');alert('Push sukses: '+(j.url||j.commit||'OK'))}catch(err){console.error(err);$('#pushStatus').textContent='âŒ Gagal: '+String(err).slice(0,200);alert('Push error: '+String(err))}}
$('#btnPush').onclick=doPush;$('#m_gen').onclick=()=>$('#btnGenerate').click();$('#m_push').onclick=()=>$('#btnPush').click();

async function checkFn(){try{const r=await fetch('/.netlify/functions/pushJson',{method:'GET'});const t=await r.text();console.log('FN GET',r.status,t.slice(0,200));$('#pushStatus').textContent='Fn:'+r.status}catch(e){console.warn(e);$('#pushStatus').textContent='Fn err'} }checkFn();

</script></body></html>
